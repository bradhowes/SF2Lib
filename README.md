[![Swift](https://github.com/bradhowes/SF2Lib/workflows/CI/badge.svg)]()
[![](https://img.shields.io/endpoint?url=https%3A%2F%2Fswiftpackageindex.com%2Fapi%2Fpackages%2Fbradhowes%2Fmorkandmidi%2Fbadge%3Ftype%3Dswift-versions)](https://swiftpackageindex.com/bradhowes/SF2Lib)
[![](https://img.shields.io/endpoint?url=https%3A%2F%2Fswiftpackageindex.com%2Fapi%2Fpackages%2Fbradhowes%2Fmorkandmidi%2Fbadge%3Ftype%3Dplatforms)](https://swiftpackageindex.com/bradhowes/SF2Lib)
[![Swift 5.4](https://img.shields.io/badge/Swift-5.4-orange.svg?style=flat)](https://swift.org)
[![License: MIT](https://img.shields.io/badge/License-MIT-A31F34.svg)](https://opensource.org/licenses/MIT)

# SF2Lib - an SF2 library in C++ (mostly)

This library can read SF2 SoundFont files and render audio samples from them. It properly reads in a compliant SF2 file
and can be used to obtain meta data such as preset names. It also has an audio rendering engine that can generate audio
samples for key events that come from (say) a MIDI keyboard. Work on the rendering side is still on-going, but at
present it can generate audio at the right pitch. This library is currently being used by my
[SoundFonts](https://github.com/bradhowes/SoundFonts) application for SF2 file parsing, and soon for rendering.

Although much of the code is generic C++17, there are bits that expect an Apple platform that has
the AudioToolbox and Accelerate frameworks available. As such, there are some code files that have the `.mm` suffix
so that they compile as Obj-C++ instead of C++. However, such cases are fairly isolated. The goal is to be a
simple library for reading SF2 files as well as a competent SF2 audio renderer whose output can be fed to any sort of
audio processing chain, not just macOS and iOS systems Core Audio systems. For my own use, this will be used in AUv3
components on iOS and macOS platforms.

# SF2 Spec Support

Currently, all SF2 generators and modulators are supported and/or implemented, *except* for the following:

* chorusEffectSend -- how much of a rendered sample is sent to a chorus effect audio channel (L+R)
* reverbEffectSend -- how much of a rendered sample is sent to a reverb effect audio channel (L+R)

Since there are plenty of chorus and reverb effects available, this library will not have any of its own. Rather the
goal will be to make available the effect send busses for other AUv3 nodes to process as they wish. This is the case
now: the render [Engine](Sources/SF2Lib/include/SF2Lib/Render/Engine/Engine.hpp) `renderInto` method takes a
[Mixer](Sources/SF2Lib/include/SF2Lib/Utils/Mixer.hpp) instance which supports a main "dry" bus and two busses
for the "chorus effect send" and a "reverb effect send". These are populated with samples from active voices,
and their levels are controlled by the `chorusEffectSend` and `reverbEffectSend` parameters mentioned above. One
can then connect bus 1 to a chorus effect and bus 2 to reverb, and then connect those outputs and bus 0 of this
library to a mixer to generate the final output.

# DSPTableGenerator

The SF2Lib relies on some lookup tables for fast value conversions of expensive operations at the cost of resolution.
The library comes with generated values, but it also has a command-line tool to regenerate it. In the Xcode project that
originally hosted this code, the generation of the table values was automated. Swift Package Manager does not support
this type of operation, so we are left with a manual step:

```
% bash regen.sh
```

# Code

Here is a rough description of the top-level folders in SF2Lib:

* [DSP](Sources/SF2Lib/DSP) -- various utility functions for signal processing and converting values from one unit to
another. Some of these conversion rely on tables generated by the `DSPTableGenerator` tool mentioned above.

* [Entity](Sources/SF2Lib/Entity) -- representations of entities defined in the SF2 spec. Provides for fast loading of
SF2 files.
* [include](Sources/SF2Lib/include) -- headers for the library. Note that the library exists mostly in header files with
very little to be found in source files.
* [IO](Sources/SF2Lib/IO) -- performs the reading and loading of SF2 files.
* [MIDI](Sources/SF2Lib/MIDI) -- state for a MIDI connection.
* [Render](Sources/SF2Lib/Render) -- handles rendering of audio samples from SF2 entities.
* [Resources](Sources/SF2Lib/Resources) -- a few SF2 files to use for experimentation and testing. Though these files
are currently packaged with SF2Lib, they are not part of the SF2Lib API.

# Credits

All of the code has been written by myself over the course of several years, but I have benefitted from the existence of
other projects, especially [FluidSynth](https://www.fluidsynth.org) and their wealth of knowledge in all things SF2.
In particular, if there is any confusion about what the SF2 spec means, I rely on their interpretation in code. That
said, any misrepresentations of SF2 functionality are of my own doing.
e
